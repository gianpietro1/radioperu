= render partial: 'artists/artists_header'

.row
  .col-md-1
  .col-md-10
    .pull-right
      - if policy(@song).edit?
        =link_to t(:edit_song), edit_artist_album_song_path(@artist,@album,@song), class: 'btn btn-warning'
      - if policy(@song).destroy?   
        =link_to t(:delete_song), [@artist,@album,@song], method: :delete, class: 'btn btn-danger', data: { confirm: t(:delete_song_confirm) }
    
.row
  .col-md-1
  .col-md-10
    %h3.catalogue_title
      %span.catalogue_title
        = (link_to @artist.name, @artist)
      %span
        =  ' - '
      %span.catalogue_title
        = (link_to @album.name, [@artist,@album])
      %span
        = ' - ' + @song.name
  .col-md-1

.row
  .col-md-1
  .col-md-6
    %div{"oncontextmenu"=>"return false"}
      %ul.playlist.song-playlist
        %h4
          =t(:click_to_play)
        %li{id: "li"}
          - offset = ENV["SOUND_OFFSET"].to_i
          %a{ href: ('#')*offset + "password" + '#' + rand(0..43254735465623).to_s + '#' + @song.filename.file.basename + '#' + ".mp3"}
            - if @songs.last.discnum && @songs.last.discnum > 1                 
              - if @song.track
                = format('%02d', @song.discnum).to_s + '-' + format('%02d', @song.track).to_s + ' ' + @song.name
              - elsif @song.name
                = '00' + ' ' + @song.name
            - else
              - if @song.track
                = format('%02d', @song.track).to_s + ' ' + @song.name
              - elsif @song.name
                = '00' + ' ' + @song.name
    - unless @song.review.nil? || @song.review.empty?
      %h4
        =t(:song_review)      
      %p.margin-top-05
        .song-video
          = @song.review
    %h4
      =t(:song_video_title)
    %p.margin-top-05
      .song-video
        - if @song.video == nil || @song.video == ''
          = t(:video_not_available)
        - else
          - @video_id = VideoInfo.new(@song.video).video_id
          %iframe{:allowscriptaccess => "always", :allowFullScreen => "true", :frameborder => "0", :height => "430", :src => "http://www.youtube.com/embed/#{@video_id}", :title => "YouTube video player", :width => "640"}
    
  .col-md-4
    %h4
      =t(:song_lyrics)
    %p.margin-top-05
      - if @song.lyrics.nil? || @song.lyrics.empty?
        = t(:lyrics_not_available)
      - else
        = @song.lyrics.gsub(/(?:\n\r?|\r\n?)/, "<br>").html_safe 

%script{:type=>"text/javascript"}

  var locale = "#{I18n.locale}";
  var album_name = "#{@album.name}"

  function sound_offset(){
  $.ajax({data: { album_name: album_name }, type: 'get', url: "/" + locale + "/sound_offset",
  success: function(r) { 
  smglch_offset = parseInt(r.split('#')[0]);
  smglch_hash1 = r.split('#')[1];
  smglch_hash2 = r.split('#')[2];
  smglch_hash3 = r.split('#')[3];
  }});
  }

  sound_offset();
