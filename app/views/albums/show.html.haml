= render partial: 'artists/artists_header'

.row
  .col-md-1
  .col-md-10
    .pull-right
      - if policy(@album).edit?
        =link_to t(:edit_album), edit_artist_album_path(@artist,@album), class: 'btn btn-warning'
      - if policy(@album).destroy?
        =link_to t(:delete_album), [@artist,@album], method: :delete, class: 'btn btn-danger', data: { confirm: t(:delete_album_confirm) }
    
.row
  .col-md-1
  .col-md-10
    %h3.catalogue_title
      %span.catalogue_title
        = (link_to @artist.name, @artist) 
      %span
        = ' - ' + @album.name
  .col-md-1

.row
  .col-md-1
  .col-md-7
    .album_image
      - if @album.cover?
        = image_tag( @album.cover )
      - else
        = image_tag( 'default_album.jpg' )
    .album_mininfo
      %strong
        = t(:album_year) + ": "
      = @album.year
      %br
      %strong
        = t(:album_format) + ": "
      - if @album.format
        = @album.format.name
      %br
      %strong
        = t(:genre) + ": "
      = @album.genre.name
    .album_bio
      %br
        - unless @album.review.nil? || @album.review.empty?
          = @album.review
        - else
          = t(:album_review_not_available)
  .col-md-1

.row
  .col-md-1
  .col-md-8
    .album_songs
      %div{"oncontextmenu"=>"return false"}
        %ul.playlist
          %h5 
            =t(:click_to_play_arrow_for_details)
          - @songs.each do |song|
            %li{id: "li"}
              .pointer
                - if song.name != ''
                  =link_to raw("&#10138;"), [@artist,@album,song]
              - offset = ENV["SOUND_OFFSET"].to_i
              %a{ href: ('%')*offset + "password" + '%' + rand(0..43254735465623).to_s + '%' + song.filename.file.basename + '%' + ".ogg"}
                - if song.track
                  = format('%02d', song.track).to_s + ' ' + song.name
                - elsif song.name
                  = '00' + ' ' + song.name
                - else
                  = ''
      %p.margin-top-10
        - if @artist.albums.count > 1
          = link_to '<', [@artist,@album.prev(@albums_array,@artist)], class: 'btn btn-info btn-sm pull-left'
          = link_to '>', [@artist,@album.next(@albums_array,@artist)], class: 'btn btn-info btn-sm pull-right'
  .col-md-4

%script{:type=>"text/javascript"}

  var locale = "#{I18n.locale}";
  var album_name = "#{@album.name}"

  function sound_offset(){
  $.ajax({data: { album_name: album_name }, type: 'get', url: "/" + locale + "/sound_offset",
  success: function(r) { 
  smglch_offset = parseInt(r.split('%')[0]);
  smglch_hash1 = r.split('%')[1];
  smglch_hash2 = r.split('%')[2];
  smglch_hash3 = r.split('%')[3];
  }});
  }

  sound_offset();
